# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ –∫–∞—Å—Ç–∏–Ω–≥–∞—Ö

## üìã –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Telegram –∫–∞–Ω–∞–ª–æ–≤ —Å –∫–∞—Å—Ç–∏–Ω–≥–∞–º–∏, –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é LLM –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä-–º–æ–Ω–∏—Ç–æ—Ä** - —Å–ª—É—à–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª–∞—Ö
2. **LLM –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** - –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–µ–∫—Å—Ç–∞
3. **ClickHouse –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã LLM –∞–Ω–∞–ª–∏–∑–∞
4. **Telegram –∫–ª–∏–µ–Ω—Ç** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram API

### –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

```
Telegram Channel ‚Üí Docker Container ‚Üí LLM Processing ‚Üí ClickHouse Storage
```

## üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `castings_messages` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)

–û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ –∫–∞—Å—Ç–∏–Ω–≥–∞—Ö:

```sql
CREATE TABLE castings_messages (
    message_id UInt64,
    channel_id UInt64,
    channel_title String,
    channel_username String,
    date DateTime,
    text String,
    views UInt32,
    forwards UInt32,
    replies UInt32,
    media_type String,
    has_photo UInt8,
    has_video UInt8,
    has_document UInt8,
    -- –ü–∞—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è
    casting_type String,
    age_range String,
    location String,
    contact_info String,
    deadline String,
    payment String,
    project_name String,
    parsed_at DateTime DEFAULT now(),
    -- –ù–û–í–û–ï –ü–û–õ–ï: LLM –∞–Ω–∞–ª–∏–∑
    llm_analysis JSON DEFAULT '{}'
) ENGINE = MergeTree()
ORDER BY (channel_id, date)
PARTITION BY toYYYYMM(date)
```

### –ù–æ–≤–æ–µ –ø–æ–ª–µ `llm_analysis`

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ LLM –∞–Ω–∞–ª–∏–∑–∞:

```json
{
  "success": true,
  "message_type": "casting_analysis",
  "model_used": "deepseek-chat",
  "timestamp": "2025-09-17T23:20:30.018044",
  "extracted_data": {
    "message_type": "–∫–∞—Å—Ç–∏–Ω–≥",
    "casting_type": "—Ä–µ–∫–ª–∞–º–∞",
    "actors": [
      {
        "gender": "–º—É–∂—á–∏–Ω–∞",
        "age_range": "30-40 –ª–µ—Ç",
        "role_features": "—Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ"
      },
      {
        "gender": "–∂–µ–Ω—â–∏–Ω–∞",
        "age_range": "25-35 –ª–µ—Ç",
        "role_features": "—Ä–æ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞"
      }
    ],
    "has_target_woman": false
  },
  "cost_info": {
    "input_tokens": 534,
    "output_tokens": 100,
    "total_tokens": 634,
    "cache_hit": false,
    "input_cost_usd": 0.000299,
    "output_cost_usd": 0.000168,
    "total_cost_usd": 0.000467
  },
  "error": null
}
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Telegram –∫–ª–∏–µ–Ω—Ç–æ–º

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram API —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ—Å—Å–∏—é
2. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ @castings
3. –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ, –æ—Ç –∫–∞—Å—Ç–∏–Ω–≥–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤: –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `config/castings_channels.py`
- –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π: text, photo —Å –ø–æ–¥–ø–∏—Å—å—é, document —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è: —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–µ—Ä–µ—Å—ã–ª–∫–∏

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ LLM

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** –ú–æ–¥—É–ª—å `src/llm/deepseek.py`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ DeepSeek API
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –∫–∞—Å—Ç–∏–Ω–≥–µ
4. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ JSON –æ—Ç–≤–µ—Ç–∞

**–ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (–∫–∞—Å—Ç–∏–Ω–≥/—Ä–µ–∫–ª–∞–º–∞/–ø—Ä–æ—á–µ–µ)
- –¢–∏–ø –∫–∞—Å—Ç–∏–Ω–≥–∞ (–∫–∏–Ω–æ/—Å–µ—Ä–∏–∞–ª/—Ä–µ–∫–ª–∞–º–∞/—Ç–µ–∞—Ç—Ä)
- –°–ø–∏—Å–æ–∫ –∞–∫—Ç–µ—Ä–æ–≤ —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏
- –ù–∞–ª–∏—á–∏–µ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (–∂–µ–Ω—â–∏–Ω—ã 30-45 –ª–µ—Ç)

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ClickHouse

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** –ú–æ–¥—É–ª—å `src/database/clickhouse_client.py`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ LLM —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
3. –í—Å—Ç–∞–≤–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `castings_messages`
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `llm_analysis`

## üê≥ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```
casting-monitor/
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ monitor.py          # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ message_processor.py # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ       ‚îî‚îÄ‚îÄ settings.py     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .env                    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. `monitor.py` - –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å

```python
class CastingMonitor:
    def __init__(self):
        self.telegram_client = None
        self.llm_processor = None
        self.clickhouse_client = None
        
    async def start_monitoring(self):
        """–ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞–Ω–∞–ª–æ–≤"""
        
    async def process_new_message(self, message):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        
    async def stop_monitoring(self):
        """–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞"""
```

#### 2. `message_processor.py` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π

```python
class MessageProcessor:
    def __init__(self):
        self.llm_client = None
        self.clickhouse_client = None
        
    async def process_message(self, message):
        """–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        # 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ClickHouse
        # 2. LLM –∞–Ω–∞–ª–∏–∑
        # 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å LLM —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
        
    async def save_to_clickhouse(self, message_data):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ClickHouse"""
        
    async def analyze_with_llm(self, text):
        """–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ LLM"""
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Telegram API
API_ID_TG=your_api_id
API_HASH_TG=your_api_hash
PHONE_NUMBER=your_phone

# ClickHouse
CLICKHOUSE_HOST=clickhouse
CLICKHOUSE_PORT=8123
CLICKHOUSE_USER=clickhouse_admin
CLICKHOUSE_PASSWORD=your_password
CLICKHOUSE_DB=telegram_analytics

# LLM API
DEEPSEEK_API_KEY=your_deepseek_key

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
MONITOR_INTERVAL=5  # —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
BATCH_SIZE=10       # —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
MAX_RETRIES=3       # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–µ
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–æ–≤:**
- `INFO` - –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (–Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —É—Å–ø–µ—à–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- `WARNING` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–ø—Ä–æ–ø—É—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏)
- `ERROR` - –æ—à–∏–±–∫–∏ (—Å–±–æ–∏ API, –ø—Ä–æ–±–ª–µ–º—ã —Å –ë–î)
- `DEBUG` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:**
```
2025-09-17 23:20:30 - casting_monitor - INFO - –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ @casting_channel
2025-09-17 23:20:31 - llm_processor - INFO - LLM –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ
2025-09-17 23:20:32 - clickhouse_client - INFO - –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î
```

### –ú–µ—Ç—Ä–∏–∫–∏

**–°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ LLM
- –°—Ç–æ–∏–º–æ—Å—Ç—å LLM –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫:**
- –õ–æ–≥–∏ –≤ stdout (–¥–ª—è Docker)
- –ú–µ—Ç—Ä–∏–∫–∏ –≤ ClickHouse (—Ç–∞–±–ª–∏—Ü–∞ `monitoring_metrics`)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –°–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–§–∞–π–ª: `config/castings_channels.py`

```python
CASTINGS_CHANNELS = [
    {
        "username": "@casting_channel_1",
        "title": "–ö–∞—Å—Ç–∏–Ω–≥–∏ –ú–æ—Å–∫–≤—ã",
        "enabled": True,
        "priority": 1
    },
    {
        "username": "@casting_channel_2", 
        "title": "–ê–∫—Ç–µ—Ä—Å–∫–∏–µ –∫–∞—Å—Ç–∏–Ω–≥–∏",
        "enabled": True,
        "priority": 2
    }
]
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM

```python
LLM_CONFIG = {
    "model": "deepseek-chat",
    "max_tokens": 1000,
    "temperature": 0.1,
    "timeout": 30,
    "retry_attempts": 3
}
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository>
cd bot_answer

# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp env.example .env
# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

### 2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∞ –∫–∞—Å—Ç–∏–Ω–≥–æ–≤
docker-compose up -d casting-monitor

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f casting-monitor
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç—ã

```bash
# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker-compose ps

# –õ–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∞
docker-compose logs casting-monitor

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ClickHouse
docker-compose exec clickhouse clickhouse-client
```

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–Ω–∞–ª–∞–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
```sql
SELECT 
    channel_username,
    COUNT(*) as total_messages,
    COUNT(CASE WHEN JSONExtractString(llm_analysis, 'success') = 'true' THEN 1 END) as successful_llm,
    AVG(JSONExtractFloat(llm_analysis, 'cost_info.total_cost_usd')) as avg_cost
FROM castings_messages 
WHERE date >= now() - INTERVAL 7 DAY
GROUP BY channel_username
ORDER BY total_messages DESC;
```

#### –¢–æ–ø —Ç–∏–ø–æ–≤ –∫–∞—Å—Ç–∏–Ω–≥–æ–≤
```sql
SELECT 
    JSONExtractString(llm_analysis, 'extracted_data.casting_type') as casting_type,
    COUNT(*) as count
FROM castings_messages 
WHERE JSONExtractString(llm_analysis, 'success') = 'true'
    AND date >= now() - INTERVAL 30 DAY
GROUP BY casting_type
ORDER BY count DESC;
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–∫—Ç–µ—Ä–∞–º
```sql
SELECT 
    JSONExtractString(actor, 'gender') as gender,
    JSONExtractString(actor, 'age_range') as age_range,
    COUNT(*) as count
FROM castings_messages 
ARRAY JOIN JSONExtractArrayRaw(llm_analysis, 'extracted_data.actors') as actor
WHERE JSONExtractString(llm_analysis, 'success') = 'true'
    AND date >= now() - INTERVAL 30 DAY
GROUP BY gender, age_range
ORDER BY count DESC;
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ API –∫–ª—é—á–µ–π
- –í—Å–µ –∫–ª—é—á–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –û—Ç–¥–µ–ª—å–Ω—ã–µ .env —Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
- –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- ClickHouse –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏
- Telegram API —á–µ—Ä–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã ClickHouse
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –≤ Git
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–π –≤ –ø–∞–ø–∫–µ `sessions/`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ API

2. **–û—à–∏–±–∫–∏ LLM API**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–∞ DeepSeek
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏–º–∏—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∞–∫–∫–∞—É–Ω—Ç–∞

3. **–ü—Ä–æ–±–ª–µ–º—ã —Å ClickHouse**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ ClickHouse

### –ö–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose ps

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose logs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ClickHouse
docker-compose exec clickhouse clickhouse-client --query "SELECT 1"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
docker-compose exec clickhouse clickhouse-client --query "SELECT * FROM castings_messages ORDER BY date DESC LIMIT 10"
```

## üìù –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `llm_analysis` –≤ —Ç–∞–±–ª–∏—Ü—É
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–æ–≤
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–∞ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∫–∞–Ω–∞–ª–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ API
- [ ] –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞
