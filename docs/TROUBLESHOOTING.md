# Руководство по устранению проблем

## Проблемы с групповым автоответчиком

### Ошибка: "Cannot find any entity corresponding to"

**Симптомы:**
```
ValueError: Cannot find any entity corresponding to "Test_bogd.group"
```

**Причины:**
1. Группа с указанным именем не существует
2. Бот не добавлен в группу
3. Неправильный формат имени группы
4. Группа приватная и нужен числовой ID

**Решения:**

#### 1. Проверьте формат GROUP_NAME

```bash
# Правильные форматы:
export GROUP_NAME=@group_username        # Публичная группа
export GROUP_NAME=-1001234567890         # Приватная группа (числовой ID)
export GROUP_NAME=group_username         # Без @ (для некоторых случаев)
```

#### 2. Найдите правильное имя группы

Используйте команду для показа доступных групп:

```bash
python main.py --list-groups
```

Эта команда покажет все группы, в которых есть бот.

#### 3. Добавьте бота в группу

1. Создайте группу в Telegram
2. Добавьте бота в группу как администратора
3. Дайте боту права на отправку сообщений
4. Используйте правильное имя группы

#### 4. Получите числовой ID для приватной группы

Для приватных групп используйте числовой ID:

```bash
# Пример ID приватной группы
export GROUP_NAME=-1001234567890
```

### Ошибка: "database is locked"

**Симптомы:**
```
ERROR - Ошибка авторизации: database is locked
```

**Причины:**
- Другой процесс использует базу данных
- Неправильное завершение предыдущего запуска

**Решения:**

#### 1. Остановите все процессы бота

```bash
# Найдите процессы Python
ps aux | grep python

# Остановите процессы бота
pkill -f "python.*main.py"
pkill -f "python.*bot"
```

#### 2. Перезапустите базу данных (если используется Docker)

```bash
# Остановите контейнеры
docker-compose down

# Запустите заново
docker-compose up -d
```

#### 3. Удалите файлы блокировки (если используется SQLite)

```bash
# Найдите и удалите файлы .db-wal, .db-shm
rm -f *.db-wal *.db-shm
```

### Ошибка: "GROUP_NAME environment variable is required"

**Симптомы:**
```
ERROR - Переменная окружения GROUP_NAME не задана!
ValueError: GROUP_NAME environment variable is required
```

**Решение:**

Установите переменную окружения:

```bash
# Временная установка (для текущей сессии)
export GROUP_NAME=@your_group_username

# Постоянная установка (добавьте в ~/.bashrc)
echo 'export GROUP_NAME=@your_group_username' >> ~/.bashrc
source ~/.bashrc

# Или добавьте в .env файл
echo 'GROUP_NAME=@your_group_username' >> .env
```

### Проблемы с правами бота

**Симптомы:**
- Бот не отвечает на сообщения
- Ошибки при отправке сообщений
- Ошибка "Cannot find any entity" даже при существующей группе
- Статус бота "has no access to messages"

**Решения:**

#### 1. Проверьте права бота в группе

1. Откройте группу в Telegram
2. Перейдите в "Управление группой" → "Администраторы"
3. Убедитесь, что бот добавлен как администратор
4. **КРИТИЧЕСКИ ВАЖНО** - проверьте права:
   - ✅ **Отправка сообщений** (обязательно!)
   - ✅ **Удаление сообщений** (опционально)
   - ✅ **Блокировка пользователей** (опционально)

#### 2. Если бот показывает "has no access to messages"

Это означает, что бот добавлен в группу, но не имеет прав администратора:

1. Удалите бота из группы
2. Добавьте бота заново как администратора
3. Обязательно включите право "Отправка сообщений"

#### 2. Проверьте режим работы

Убедитесь, что в `.env` файле правильно настроен режим:

```env
# Для работы через бота
USE_USER_ACCOUNT=false

# Для работы от имени пользователя
USE_USER_ACCOUNT=true
```

### Проблемы с авторизацией

**Симптомы:**
```
ERROR - Ошибка авторизации: ...
```

**Решения:**

#### 1. Проверьте настройки API

Убедитесь, что в `.env` файле правильно указаны:

```env
API_ID_TG=your_api_id
API_HASH_TG=your_api_hash
PHONE_NUMBER=+1234567890
BOT_TOKEN=your_bot_token
```

#### 2. Удалите старые сессии

```bash
# Удалите файлы сессий
rm -f sessions/*.session
```

#### 3. Переавторизуйтесь

Запустите бота заново - он запросит код подтверждения.

## Общие рекомендации

### 1. Проверка логов

Всегда проверяйте логи для диагностики проблем:

```bash
# Просмотр логов
tail -f logs/telegram_bot.log

# Просмотр ошибок
tail -f logs/telegram_bot_errors.log
```

### 2. Тестирование подключения

Перед запуском бота протестируйте подключение:

```bash
# Проверка доступных ботов
python main.py --list

# Проверка доступных групп
python main.py --list-groups
```

### 3. Пошаговая диагностика

1. Проверьте переменные окружения
2. Проверьте права бота в группе
3. Проверьте формат GROUP_NAME
4. Проверьте логи на наличие ошибок
5. Протестируйте с простым ботом (simple) перед групповым

### 4. Получение помощи

Если проблемы продолжаются:

1. Сохраните полные логи ошибок
2. Укажите версию Python и операционную систему
3. Опишите шаги, которые привели к ошибке
4. Укажите формат GROUP_NAME (без чувствительных данных)
